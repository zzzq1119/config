allow-lan: true # 允许局域网连接
bind-address: "*" # 绑定 IP 地址，仅作用于 allow-lan 为 true，'*'表示所有地址

find-process-mode: strict

mode: rule

#自定义 geodata url
geox-url:
  geoip: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.metadb"

geo-auto-update: true # 是否自动更新 geodata
geo-update-interval: 24 # 更新间隔，单位：小时

log-level: debug

ipv6: true 

external-controller: 0.0.0.0:9090 # RESTful API 监听地址

# 配置 WEB UI 目录，使用 http://{{external-controller}}/ui 访问
external-ui-name: xd
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"
global-client-fingerprint: chrome

profile: # 存储 select 选择记录
  store-selected: true

  # 持久化 fake-ip
  store-fake-ip: true

# Tun 配置
tun:
  enable: false
  stack: mixed # gvisor/mixed
  dns-hijack:
    - 0.0.0.0:53 # 需要劫持的 DNS
  auto-detect-interface: true # 自动识别出口网卡
  auto-route: true # 配置路由表
  # mtu: 9000 # 最大传输单元
  # gso: false # 启用通用分段卸载，仅支持 Linux
  # gso-max-size: 65536 # 通用分段卸载包的最大大小
  strict-route: true # 将所有连接路由到 tun 来防止泄漏，但你的设备将无法其他设备被访问
  inet4-route-address: # 启用 auto-route 时使用自定义路由而不是默认路由
    - 0.0.0.0/1
    - 128.0.0.0/1
  inet6-route-address: # 启用 auto-route 时使用自定义路由而不是默认路由
    - "::/1"
    - "8000::/1"

# 嗅探域名 可选配置
sniffer:
  enable: true 
  sniff: # TLS 和 QUIC 默认如果不配置 ports 默认嗅探 443
    QUIC:
      ports: [ 443 ]
    TLS:
      ports: [443, 8443]
    HTTP: # 需要嗅探的端口
      ports: [80, 8080-8880]
      
# DNS 配置
dns:
  cache-algorithm: arc
  enable: true # 关闭将使用系统 DNS
  listen: 0.0.0.0:53 # 开启 DNS 服务器监听
  ipv6: true # false 将返回 AAAA 的空结
  enhanced-mode: fake-ip # or redir-host
  nameserver-policy:
  'geosite:cn': [tls://8.8.4.4, https://1.0.0.1/dns-query]
  'www.baidu.com,+.google.cn': https://doh.pub/dns-query
  'geosite:private,apple': https://dns.alidns.com/dns-query
  'rule-set:google,cloudflare': 8.8.8.8

  fake-ip-range: 198.18.0.1/16 # fake-ip 池设置

proxy-providers:
  xyjwbi:
    type: http
    url: "https://1.xn--xc3ao8r.top/api/v1/client/subscribe?token=eb42279a35899f7300e3d1074b69c26b"
    path: ./proxy_providers/xyjwbi.yaml
    interval: 3600
    proxy: DIRECT
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
proxy-groups:
  - name: "proxy"
    type: select
    proxies:
      - DIRECT
      - auto
    use:
      - xyjwbi
      
  - name: "auto"
    type: url-test
    use:
      - xyjwbi
    url: 'https://www.gstatic.com/generate_204'
    interval: 300
    tolerance: 5
    
rules:
